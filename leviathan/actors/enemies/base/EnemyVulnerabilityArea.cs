using Godot;

public partial class EnemyVulnerabilityArea : Area2D
{

	[Export]
	public Enemy Enemy;

	public override void _Ready()
	{
		base._Ready();
		if (Enemy == null)
		{
			Enemy = NodeUtils.GetNearestAncestorNode<Enemy>(this);
		}
		Monitoring = true;
		if (Enemy == null)
		{
			Monitoring = false;
			GD.Print(this, " was created with no enemy ancestor, disabling");
		}
		else
		{
			AreaEntered += OnCollideWithPlayerAttack;
			Enemy.OnStartTakeDamage += OnEnemyStartTakeDamage;
			Enemy.OnEndTakeDamage += OnEnemyEndTakeDamage;
		}

	}

	protected void OnCollideWithPlayerAttack(Area2D attack)
	{
		// player attack = layer 3
		if (!attack.GetCollisionLayerValue(3))
		{
			return;
		}
		Enemy.TakeDamage(1, attack);
	}

	protected void OnEnemyStartTakeDamage(Enemy enemy)
	{
		Monitoring = false;
	}

	protected void OnEnemyEndTakeDamage(Enemy enemy)
	{
		Monitoring = true;
	}
}